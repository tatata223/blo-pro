@echo off
REM ะกะบัะธะฟั ะดะปั ะทะฐะฟััะบะฐ ะฑัะบะตะฝะดะฐ ะธ ััะพะฝัะตะฝะดะฐ ะพะดะฝะพะน ะบะพะผะฐะฝะดะพะน (Windows)

echo ๐ ะะฐะฟััะบ ะฟัะธะปะพะถะตะฝะธั ะะฐะผะตัะบะธ...
echo.

REM ะัะพะฒะตัะบะฐ ะฝะฐะปะธัะธั Python 3
where python3 >nul 2>nul
if %ERRORLEVEL% NEQ 0 (
    echo โ Python 3 ะฝะต ะฝะฐะนะดะตะฝ. ะฃััะฐะฝะพะฒะธัะต Python 3.
    pause
    exit /b 1
)

REM ะัะพะฒะตัะบะฐ ะฝะฐะปะธัะธั Node.js
where node >nul 2>nul
if %ERRORLEVEL% NEQ 0 (
    echo โ Node.js ะฝะต ะฝะฐะนะดะตะฝ. ะฃััะฐะฝะพะฒะธัะต Node.js.
    pause
    exit /b 1
)

REM ะัะพะฒะตัะบะฐ ะฝะฐะปะธัะธั npm
where npm >nul 2>nul
if %ERRORLEVEL% NEQ 0 (
    echo โ npm ะฝะต ะฝะฐะนะดะตะฝ. ะฃััะฐะฝะพะฒะธัะต npm.
    pause
    exit /b 1
)

REM ะะตัะตัะพะด ะฒ ะดะธัะตะบัะพัะธั ะฑัะบะตะฝะดะฐ
cd backend
if %ERRORLEVEL% NEQ 0 (
    echo โ ะะธัะตะบัะพัะธั backend ะฝะต ะฝะฐะนะดะตะฝะฐ
    pause
    exit /b 1
)

REM ะัะพะฒะตัะบะฐ ะฒะธัััะฐะปัะฝะพะณะพ ะพะบััะถะตะฝะธั
if not exist "venv" (
    echo ๐ฆ ะกะพะทะดะฐะฝะธะต ะฒะธัััะฐะปัะฝะพะณะพ ะพะบััะถะตะฝะธั...
    python3 -m venv venv
)

REM ะะบัะธะฒะฐัะธั ะฒะธัััะฐะปัะฝะพะณะพ ะพะบััะถะตะฝะธั
echo ๐ง ะะบัะธะฒะฐัะธั ะฒะธัััะฐะปัะฝะพะณะพ ะพะบััะถะตะฝะธั...
call venv\Scripts\activate.bat

REM ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน ะฑัะบะตะฝะดะฐ
echo ๐ฅ ะัะพะฒะตัะบะฐ ะทะฐะฒะธัะธะผะพััะตะน ะฑัะบะตะฝะดะฐ...
python3 -c "import django" 2>nul
if %ERRORLEVEL% NEQ 0 (
    echo ๐ฅ ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน ะฑัะบะตะฝะดะฐ...
    pip3 install -r requirements.txt
    if %ERRORLEVEL% NEQ 0 (
        echo โ ะัะธะฑะบะฐ ัััะฐะฝะพะฒะบะธ ะทะฐะฒะธัะธะผะพััะตะน
        pause
        exit /b 1
    )
)

REM ะกะพะทะดะฐะฝะธะต ะผะธะณัะฐัะธะน
echo ๐ ะกะพะทะดะฐะฝะธะต ะผะธะณัะฐัะธะน...
python3 manage.py makemigrations 2>nul

REM ะัะฟะพะปะฝะตะฝะธะต ะผะธะณัะฐัะธะน
echo ๐๏ธ  ะัะฟะพะปะฝะตะฝะธะต ะผะธะณัะฐัะธะน...
python3 manage.py migrate --noinput
if %ERRORLEVEL% NEQ 0 (
    echo โ๏ธ  ะะพะฟััะบะฐ ะธัะฟัะฐะฒะธัั ะผะธะณัะฐัะธะธ...
    if exist "db.sqlite3" (
        echo ๐๏ธ  ะฃะดะฐะปะตะฝะธะต ััะฐัะพะน ะฑะฐะทั ะดะฐะฝะฝัั...
        del /f db.sqlite3
    )
    python3 manage.py makemigrations
    python3 manage.py migrate --noinput
    if %ERRORLEVEL% NEQ 0 (
        echo โ ะัะธัะธัะตัะบะฐั ะพัะธะฑะบะฐ ะผะธะณัะฐัะธะน
        pause
        exit /b 1
    )
)

REM ะกะพะทะดะฐะฝะธะต ััะฟะตัะฟะพะปัะทะพะฒะฐัะตะปั
echo ๐ค ะัะพะฒะตัะบะฐ ััะฟะตัะฟะพะปัะทะพะฒะฐัะตะปั...
python3 manage.py create_superuser 2>nul || echo ะกัะฟะตัะฟะพะปัะทะพะฒะฐัะตะปั ัะถะต ัััะตััะฒัะตั

REM ะะฝะธัะธะฐะปะธะทะฐัะธั ัะฐะฑะปะพะฝะพะฒ
if not exist ".templates_initialized" (
    echo ๐ ะะฝะธัะธะฐะปะธะทะฐัะธั ัะฐะฑะปะพะฝะพะฒ...
    python3 manage.py init_templates 2>nul
    if %ERRORLEVEL% EQU 0 (
        type nul > .templates_initialized
    )
)

REM ะะพะทะฒัะฐั ะฒ ะบะพัะฝะตะฒัั ะดะธัะตะบัะพัะธั
cd ..

REM ะะตัะตัะพะด ะฒ ะดะธัะตะบัะพัะธั ััะพะฝัะตะฝะดะฐ
cd frontend
if %ERRORLEVEL% NEQ 0 (
    echo โ ะะธัะตะบัะพัะธั frontend ะฝะต ะฝะฐะนะดะตะฝะฐ
    pause
    exit /b 1
)

REM ะัะพะฒะตัะบะฐ node_modules
if not exist "node_modules" (
    echo ๐ฅ ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน ััะพะฝัะตะฝะดะฐ...
    npm install
)

REM ะกะฑะพัะบะฐ React ะฟัะธะปะพะถะตะฝะธั (ะฒัะตะณะดะฐ ะฟะตัะตัะพะฑะธัะฐะตะผ)
echo ๐จ ะะตัะตัะฑะพัะบะฐ React ะฟัะธะปะพะถะตะฝะธั...
if exist "build" (
    rmdir /s /q build
)
npm run build
if %ERRORLEVEL% NEQ 0 (
    echo โ ะัะธะฑะบะฐ ัะฑะพัะบะธ React ะฟัะธะปะพะถะตะฝะธั
    pause
    exit /b 1
)
echo โ React ะฟัะธะปะพะถะตะฝะธะต ััะฟะตัะฝะพ ัะพะฑัะฐะฝะพ

REM ะะพะทะฒัะฐั ะฒ ะบะพัะฝะตะฒัั ะดะธัะตะบัะพัะธั
cd ..

REM ะะตัะตัะพะด ะพะฑัะฐัะฝะพ ะฒ backend ะดะปั ะทะฐะฟััะบะฐ ัะตัะฒะตัะฐ
cd backend
call venv\Scripts\activate.bat

REM ะะฐะฟััะบ Django ัะตัะฒะตัะฐ ะฒ ะฝะพะฒะพะผ ะพะบะฝะต
echo.
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo โ ะะฐะฟััะบ Django ัะตัะฒะตัะฐ ะฝะฐ http://localhost:8000
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo.
echo ๐ ะัะธะปะพะถะตะฝะธะต ะดะพัััะฟะฝะพ ะฝะฐ: http://localhost:8000
echo ๐ API ะดะพัััะฟะตะฝ ะฝะฐ: http://localhost:8000/api/
echo ๐ ะะดะผะธะฝ-ะฟะฐะฝะตะปั: http://localhost:8000/admin/
echo.
echo ะะพะณะธ ัะตัะฒะตัะฐ ะพัะพะฑัะฐะถะฐัััั ะฒ ะพะบะฝะต ะฝะธะถะต
echo ะะฐะบัะพะนัะต ะพะบะฝะพ ะดะปั ะพััะฐะฝะพะฒะบะธ ัะตัะฒะตัะฐ
echo.
start "Django Server - ะะฐะผะตัะบะธ" cmd /k "python3 manage.py runserver"

REM ะะพะทะฒัะฐั ะฒ ะบะพัะฝะตะฒัั ะดะธัะตะบัะพัะธั
cd ..

pause
