{"ast":null,"code":"import React,{useState,useEffect}from'react';import{marketplaceAPI,currencyAPI}from'../../api/api';import{useAuth}from'../../contexts/AuthContext';import toast from'react-hot-toast';import'./MarketplaceItem.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const MarketplaceItem=_ref=>{let{item,onPurchase}=_ref;const{user}=useAuth();const[loading,setLoading]=useState(false);const[balance,setBalance]=useState(null);useEffect(()=>{if(user){loadBalance();}},[user]);const loadBalance=async()=>{try{const response=await currencyAPI.getBalance();setBalance(response.data.balance);}catch(error){console.error('Error loading balance:',error);}};const handlePurchase=async()=>{if(!user){toast.error('Необходима авторизация');return;}if(item.is_purchased){toast.info('Товар уже куплен');return;}if(balance!==null&&balance<item.price){toast.error('Недостаточно средств');return;}setLoading(true);try{await marketplaceAPI.purchaseItem(item.id);toast.success('Товар успешно куплен!');if(onPurchase)onPurchase();loadBalance();}catch(error){var _error$response,_error$response$data;console.error('Error purchasing item:',error);toast.error(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.error)||'Ошибка покупки');}finally{setLoading(false);}};const getItemTypeLabel=type=>{const labels={template:'Шаблон',font:'Шрифт',animation:'Анимация',theme:'Тема'};return labels[type]||type;};return/*#__PURE__*/_jsxs(\"div\",{className:\"marketplace-item \".concat(item.is_purchased?'purchased':''),children:[item.preview_image&&/*#__PURE__*/_jsx(\"div\",{className:\"marketplace-item-preview\",children:/*#__PURE__*/_jsx(\"img\",{src:item.preview_image,alt:item.name})}),/*#__PURE__*/_jsxs(\"div\",{className:\"marketplace-item-content\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"marketplace-item-header\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"marketplace-item-type\",children:getItemTypeLabel(item.item_type)}),item.is_purchased&&/*#__PURE__*/_jsx(\"span\",{className:\"marketplace-item-badge\",children:\"\\u041A\\u0443\\u043F\\u043B\\u0435\\u043D\\u043E\"})]}),/*#__PURE__*/_jsx(\"h3\",{className:\"marketplace-item-name\",children:item.name}),/*#__PURE__*/_jsx(\"p\",{className:\"marketplace-item-description\",children:item.description}),/*#__PURE__*/_jsxs(\"div\",{className:\"marketplace-item-footer\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"marketplace-item-stats\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"marketplace-item-price\",children:[item.price,\" \\u043C\\u043E\\u043D\\u0435\\u0442\"]}),/*#__PURE__*/_jsxs(\"span\",{className:\"marketplace-item-rating\",children:[\"\\u2B50 \",item.rating.toFixed(1)]}),/*#__PURE__*/_jsxs(\"span\",{className:\"marketplace-item-purchases\",children:[item.purchases_count,\" \\u043F\\u043E\\u043A\\u0443\\u043F\\u043E\\u043A\"]})]}),!item.is_purchased&&/*#__PURE__*/_jsx(\"button\",{className:\"marketplace-item-buy-btn\",onClick:handlePurchase,disabled:loading||balance!==null&&balance<item.price,children:loading?'Покупка...':'Купить'})]})]})]});};export default MarketplaceItem;","map":{"version":3,"names":["React","useState","useEffect","marketplaceAPI","currencyAPI","useAuth","toast","jsx","_jsx","jsxs","_jsxs","MarketplaceItem","_ref","item","onPurchase","user","loading","setLoading","balance","setBalance","loadBalance","response","getBalance","data","error","console","handlePurchase","is_purchased","info","price","purchaseItem","id","success","_error$response","_error$response$data","getItemTypeLabel","type","labels","template","font","animation","theme","className","concat","children","preview_image","src","alt","name","item_type","description","rating","toFixed","purchases_count","onClick","disabled"],"sources":["/Users/mikhail/Downloads/ЗаметкиPARADIZE/frontend/src/components/Marketplace/MarketplaceItem.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { marketplaceAPI, currencyAPI } from '../../api/api';\nimport { useAuth } from '../../contexts/AuthContext';\nimport toast from 'react-hot-toast';\nimport './MarketplaceItem.css';\n\nconst MarketplaceItem = ({ item, onPurchase }) => {\n  const { user } = useAuth();\n  const [loading, setLoading] = useState(false);\n  const [balance, setBalance] = useState(null);\n\n  useEffect(() => {\n    if (user) {\n      loadBalance();\n    }\n  }, [user]);\n\n  const loadBalance = async () => {\n    try {\n      const response = await currencyAPI.getBalance();\n      setBalance(response.data.balance);\n    } catch (error) {\n      console.error('Error loading balance:', error);\n    }\n  };\n\n  const handlePurchase = async () => {\n    if (!user) {\n      toast.error('Необходима авторизация');\n      return;\n    }\n\n    if (item.is_purchased) {\n      toast.info('Товар уже куплен');\n      return;\n    }\n\n    if (balance !== null && balance < item.price) {\n      toast.error('Недостаточно средств');\n      return;\n    }\n\n    setLoading(true);\n    try {\n      await marketplaceAPI.purchaseItem(item.id);\n      toast.success('Товар успешно куплен!');\n      if (onPurchase) onPurchase();\n      loadBalance();\n    } catch (error) {\n      console.error('Error purchasing item:', error);\n      toast.error(error.response?.data?.error || 'Ошибка покупки');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const getItemTypeLabel = (type) => {\n    const labels = {\n      template: 'Шаблон',\n      font: 'Шрифт',\n      animation: 'Анимация',\n      theme: 'Тема',\n    };\n    return labels[type] || type;\n  };\n\n  return (\n    <div className={`marketplace-item ${item.is_purchased ? 'purchased' : ''}`}>\n      {item.preview_image && (\n        <div className=\"marketplace-item-preview\">\n          <img src={item.preview_image} alt={item.name} />\n        </div>\n      )}\n      <div className=\"marketplace-item-content\">\n        <div className=\"marketplace-item-header\">\n          <span className=\"marketplace-item-type\">{getItemTypeLabel(item.item_type)}</span>\n          {item.is_purchased && (\n            <span className=\"marketplace-item-badge\">Куплено</span>\n          )}\n        </div>\n        <h3 className=\"marketplace-item-name\">{item.name}</h3>\n        <p className=\"marketplace-item-description\">{item.description}</p>\n        <div className=\"marketplace-item-footer\">\n          <div className=\"marketplace-item-stats\">\n            <span className=\"marketplace-item-price\">{item.price} монет</span>\n            <span className=\"marketplace-item-rating\">⭐ {item.rating.toFixed(1)}</span>\n            <span className=\"marketplace-item-purchases\">{item.purchases_count} покупок</span>\n          </div>\n          {!item.is_purchased && (\n            <button\n              className=\"marketplace-item-buy-btn\"\n              onClick={handlePurchase}\n              disabled={loading || (balance !== null && balance < item.price)}\n            >\n              {loading ? 'Покупка...' : 'Купить'}\n            </button>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default MarketplaceItem;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}