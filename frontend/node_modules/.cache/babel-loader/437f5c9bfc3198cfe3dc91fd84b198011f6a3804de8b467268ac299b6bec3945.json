{"ast":null,"code":"import React,{useState,useEffect,useRef,useCallback}from'react';import toast from'react-hot-toast';import{useKeyboardShortcuts}from'../../hooks/useKeyboardShortcuts';import{notesAPI}from'../../api/api';import RichTextEditor from'./RichTextEditor';import ExportModal from'../Export/ExportModal';import'./NoteEditor.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const NoteEditor=_ref=>{let{note,folders,tags,onSave,onCancel}=_ref;const[title,setTitle]=useState((note===null||note===void 0?void 0:note.title)||'');const[content,setContent]=useState((note===null||note===void 0?void 0:note.content)||'');const[saving,setSaving]=useState(false);const[showExportModal,setShowExportModal]=useState(false);const[currentNote,setCurrentNote]=useState(note);const autoSaveTimerRef=useRef(null);useEffect(()=>{if(note){setTitle(note.title||'');setContent(note.content||'');setCurrentNote(note);}else{setCurrentNote(null);}},[note]);const handleAutoSave=useCallback(async()=>{if(!title.trim()&&!content.trim())return;try{const savedNote=await onSave({title:title.trim()||'Без названия',content:content});if(savedNote&&savedNote.id){setCurrentNote(savedNote);}}catch(error){console.error('Error auto-saving note:',error);}},[title,content,onSave]);// Автосохранение каждые 30 секунд\nuseEffect(()=>{if(autoSaveTimerRef.current){clearInterval(autoSaveTimerRef.current);}if(content&&title){autoSaveTimerRef.current=setInterval(()=>{handleAutoSave();},30000);}return()=>{if(autoSaveTimerRef.current){clearInterval(autoSaveTimerRef.current);}};},[content,title,handleAutoSave]);const handleSave=useCallback(async()=>{setSaving(true);try{const savedNote=await onSave({title:title.trim()||'Без названия',content:content});if(savedNote&&savedNote.id){setCurrentNote(savedNote);}toast.success('Заметка сохранена');}catch(error){console.error('Error saving note:',error);toast.error('Ошибка при сохранении заметки');}finally{setSaving(false);}},[title,content,onSave]);// Клавиатурные сокращения для редактора\nuseKeyboardShortcuts({'ctrl+s':e=>{e.preventDefault();handleSave();},'escape':()=>{onCancel();}},[handleSave,onCancel]);return/*#__PURE__*/_jsxs(\"div\",{className:\"note-editor\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"editor-header\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"editor-title\",placeholder:\"\\u0417\\u0430\\u0433\\u043E\\u043B\\u043E\\u0432\\u043E\\u043A \\u0437\\u0430\\u043C\\u0435\\u0442\\u043A\\u0438\",value:title,onChange:e=>setTitle(e.target.value)}),/*#__PURE__*/_jsxs(\"div\",{className:\"editor-actions\",children:[currentNote&&currentNote.id&&/*#__PURE__*/_jsx(\"button\",{className:\"btn-export\",onClick:()=>setShowExportModal(true),title:\"\\u042D\\u043A\\u0441\\u043F\\u043E\\u0440\\u0442\",children:/*#__PURE__*/_jsx(\"svg\",{width:\"24\",height:\"24\",viewBox:\"0 0 24 24\",fill:\"none\",xmlns:\"http://www.w3.org/2000/svg\",children:/*#__PURE__*/_jsx(\"path\",{d:\"M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15M17 8L12 3M12 3L7 8M12 3V15\",stroke:\"currentColor\",strokeWidth:\"2\",strokeLinecap:\"round\",strokeLinejoin:\"round\"})})}),/*#__PURE__*/_jsx(\"button\",{className:\"btn-save\",onClick:handleSave,disabled:saving,title:\"\\u0421\\u043E\\u0445\\u0440\\u0430\\u043D\\u0438\\u0442\\u044C\",children:/*#__PURE__*/_jsx(\"svg\",{width:\"24\",height:\"24\",viewBox:\"0 0 24 24\",fill:\"none\",xmlns:\"http://www.w3.org/2000/svg\",children:/*#__PURE__*/_jsx(\"path\",{d:\"M20 6L9 17L4 12\",stroke:\"#22C55E\",strokeWidth:\"2.5\",strokeLinecap:\"round\",strokeLinejoin:\"round\"})})}),/*#__PURE__*/_jsx(\"button\",{className:\"btn-cancel\",onClick:onCancel,title:\"\\u041E\\u0442\\u043C\\u0435\\u043D\\u0430\",children:/*#__PURE__*/_jsx(\"svg\",{width:\"24\",height:\"24\",viewBox:\"0 0 24 24\",fill:\"none\",xmlns:\"http://www.w3.org/2000/svg\",children:/*#__PURE__*/_jsx(\"path\",{d:\"M18 6L6 18M6 6L18 18\",stroke:\"#EF4444\",strokeWidth:\"2.5\",strokeLinecap:\"round\",strokeLinejoin:\"round\"})})})]})]}),/*#__PURE__*/_jsx(RichTextEditor,{value:content,onChange:setContent,placeholder:\"\",autoFocus:!note}),showExportModal&&currentNote&&/*#__PURE__*/_jsx(ExportModal,{note:currentNote,isOpen:showExportModal,onClose:()=>setShowExportModal(false)})]});};export default NoteEditor;","map":{"version":3,"names":["React","useState","useEffect","useRef","useCallback","toast","useKeyboardShortcuts","notesAPI","RichTextEditor","ExportModal","jsx","_jsx","jsxs","_jsxs","NoteEditor","_ref","note","folders","tags","onSave","onCancel","title","setTitle","content","setContent","saving","setSaving","showExportModal","setShowExportModal","currentNote","setCurrentNote","autoSaveTimerRef","handleAutoSave","trim","savedNote","id","error","console","current","clearInterval","setInterval","handleSave","success","e","preventDefault","escape","className","children","type","placeholder","value","onChange","target","onClick","width","height","viewBox","fill","xmlns","d","stroke","strokeWidth","strokeLinecap","strokeLinejoin","disabled","autoFocus","isOpen","onClose"],"sources":["/Users/mikhail/Downloads/ЗаметкиPARADIZE/frontend/src/components/Notes/NoteEditor.js"],"sourcesContent":["import React, { useState, useEffect, useRef, useCallback } from 'react';\nimport toast from 'react-hot-toast';\nimport { useKeyboardShortcuts } from '../../hooks/useKeyboardShortcuts';\nimport { notesAPI } from '../../api/api';\nimport RichTextEditor from './RichTextEditor';\nimport ExportModal from '../Export/ExportModal';\nimport './NoteEditor.css';\n\nconst NoteEditor = ({ note, folders, tags, onSave, onCancel }) => {\n  const [title, setTitle] = useState(note?.title || '');\n  const [content, setContent] = useState(note?.content || '');\n  const [saving, setSaving] = useState(false);\n  const [showExportModal, setShowExportModal] = useState(false);\n  const [currentNote, setCurrentNote] = useState(note);\n  const autoSaveTimerRef = useRef(null);\n\n  useEffect(() => {\n    if (note) {\n      setTitle(note.title || '');\n      setContent(note.content || '');\n      setCurrentNote(note);\n    } else {\n      setCurrentNote(null);\n    }\n  }, [note]);\n\n  const handleAutoSave = useCallback(async () => {\n    if (!title.trim() && !content.trim()) return;\n    \n    try {\n      const savedNote = await onSave({\n        title: title.trim() || 'Без названия',\n        content: content,\n      });\n      if (savedNote && savedNote.id) {\n        setCurrentNote(savedNote);\n      }\n    } catch (error) {\n      console.error('Error auto-saving note:', error);\n    }\n  }, [title, content, onSave]);\n\n  // Автосохранение каждые 30 секунд\n  useEffect(() => {\n    if (autoSaveTimerRef.current) {\n      clearInterval(autoSaveTimerRef.current);\n    }\n\n    if (content && title) {\n      autoSaveTimerRef.current = setInterval(() => {\n        handleAutoSave();\n      }, 30000);\n    }\n\n    return () => {\n      if (autoSaveTimerRef.current) {\n        clearInterval(autoSaveTimerRef.current);\n      }\n    };\n  }, [content, title, handleAutoSave]);\n\n  const handleSave = useCallback(async () => {\n    setSaving(true);\n    try {\n      const savedNote = await onSave({\n        title: title.trim() || 'Без названия',\n        content: content,\n      });\n      if (savedNote && savedNote.id) {\n        setCurrentNote(savedNote);\n      }\n      toast.success('Заметка сохранена');\n    } catch (error) {\n      console.error('Error saving note:', error);\n      toast.error('Ошибка при сохранении заметки');\n    } finally {\n      setSaving(false);\n    }\n  }, [title, content, onSave]);\n\n  // Клавиатурные сокращения для редактора\n  useKeyboardShortcuts({\n    'ctrl+s': (e) => {\n      e.preventDefault();\n      handleSave();\n    },\n    'escape': () => {\n      onCancel();\n    },\n  }, [handleSave, onCancel]);\n\n  return (\n    <div className=\"note-editor\">\n      <div className=\"editor-header\">\n        <input\n          type=\"text\"\n          className=\"editor-title\"\n          placeholder=\"Заголовок заметки\"\n          value={title}\n          onChange={(e) => setTitle(e.target.value)}\n        />\n        <div className=\"editor-actions\">\n          {currentNote && currentNote.id && (\n            <button \n              className=\"btn-export\" \n              onClick={() => setShowExportModal(true)} \n              title=\"Экспорт\"\n            >\n              <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                <path d=\"M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15M17 8L12 3M12 3L7 8M12 3V15\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/>\n              </svg>\n            </button>\n          )}\n          <button className=\"btn-save\" onClick={handleSave} disabled={saving} title=\"Сохранить\">\n            <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n              <path d=\"M20 6L9 17L4 12\" stroke=\"#22C55E\" strokeWidth=\"2.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/>\n            </svg>\n          </button>\n          <button className=\"btn-cancel\" onClick={onCancel} title=\"Отмена\">\n            <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n              <path d=\"M18 6L6 18M6 6L18 18\" stroke=\"#EF4444\" strokeWidth=\"2.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/>\n            </svg>\n          </button>\n        </div>\n      </div>\n\n      <RichTextEditor\n        value={content}\n        onChange={setContent}\n        placeholder=\"\"\n        autoFocus={!note}\n      />\n      \n      {showExportModal && currentNote && (\n        <ExportModal\n          note={currentNote}\n          isOpen={showExportModal}\n          onClose={() => setShowExportModal(false)}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default NoteEditor;\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}