{"ast":null,"code":"import React,{useState,useEffect,useRef}from'react';import{tagsAPI}from'../../api/api';import'./TagAutocomplete.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const TagAutocomplete=_ref=>{let{onSelect,selectedTags=[],placeholder='Добавить тег...'}=_ref;const[query,setQuery]=useState('');const[suggestions,setSuggestions]=useState([]);const[showSuggestions,setShowSuggestions]=useState(false);const[loading,setLoading]=useState(false);const inputRef=useRef(null);const suggestionsRef=useRef(null);useEffect(()=>{if(query.trim().length>0){loadSuggestions();}else{setSuggestions([]);setShowSuggestions(false);}},[query]);useEffect(()=>{const handleClickOutside=event=>{if(suggestionsRef.current&&!suggestionsRef.current.contains(event.target)&&inputRef.current&&!inputRef.current.contains(event.target)){setShowSuggestions(false);}};document.addEventListener('mousedown',handleClickOutside);return()=>document.removeEventListener('mousedown',handleClickOutside);},[]);const loadSuggestions=async()=>{try{setLoading(true);const response=await tagsAPI.autocomplete(query);const filtered=(response.data||[]).filter(tag=>!selectedTags.includes(tag.id));setSuggestions(filtered);setShowSuggestions(filtered.length>0);}catch(error){console.error('Error loading suggestions:',error);setSuggestions([]);}finally{setLoading(false);}};const handleInputChange=e=>{setQuery(e.target.value);};const handleSelect=tag=>{if(onSelect){onSelect(tag);}setQuery('');setShowSuggestions(false);};const handleKeyDown=e=>{if(e.key==='Enter'&&suggestions.length>0){e.preventDefault();handleSelect(suggestions[0]);}else if(e.key==='Escape'){setShowSuggestions(false);}};const handleCreateNew=()=>{if(query.trim()&&onSelect){// Создаем новый тег\nonSelect({name:query.trim(),isNew:true});setQuery('');setShowSuggestions(false);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"tag-autocomplete\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"tag-autocomplete-input-wrapper\",children:[/*#__PURE__*/_jsx(\"input\",{ref:inputRef,type:\"text\",className:\"tag-autocomplete-input\",value:query,onChange:handleInputChange,onKeyDown:handleKeyDown,onFocus:()=>{if(suggestions.length>0){setShowSuggestions(true);}},placeholder:placeholder}),loading&&/*#__PURE__*/_jsx(\"span\",{className:\"autocomplete-loading\",children:\"\\u23F3\"})]}),showSuggestions&&suggestions.length>0&&/*#__PURE__*/_jsxs(\"div\",{ref:suggestionsRef,className:\"tag-autocomplete-suggestions\",children:[suggestions.map(tag=>/*#__PURE__*/_jsxs(\"div\",{className:\"tag-suggestion-item\",onClick:()=>handleSelect(tag),style:{borderLeftColor:tag.color},children:[/*#__PURE__*/_jsx(\"span\",{className:\"tag-suggestion-name\",children:tag.name}),/*#__PURE__*/_jsxs(\"span\",{className:\"tag-suggestion-count\",children:[\"(\",tag.notes_count||0,\")\"]})]},tag.id)),query.trim()&&!suggestions.find(t=>t.name.toLowerCase()===query.toLowerCase())&&/*#__PURE__*/_jsx(\"div\",{className:\"tag-suggestion-item tag-suggestion-create\",onClick:handleCreateNew,children:/*#__PURE__*/_jsxs(\"span\",{children:[\"+ \\u0421\\u043E\\u0437\\u0434\\u0430\\u0442\\u044C \\u0442\\u0435\\u0433 \\\"\",query.trim(),\"\\\"\"]})})]})]});};export default TagAutocomplete;","map":{"version":3,"names":["React","useState","useEffect","useRef","tagsAPI","jsx","_jsx","jsxs","_jsxs","TagAutocomplete","_ref","onSelect","selectedTags","placeholder","query","setQuery","suggestions","setSuggestions","showSuggestions","setShowSuggestions","loading","setLoading","inputRef","suggestionsRef","trim","length","loadSuggestions","handleClickOutside","event","current","contains","target","document","addEventListener","removeEventListener","response","autocomplete","filtered","data","filter","tag","includes","id","error","console","handleInputChange","e","value","handleSelect","handleKeyDown","key","preventDefault","handleCreateNew","name","isNew","className","children","ref","type","onChange","onKeyDown","onFocus","map","onClick","style","borderLeftColor","color","notes_count","find","t","toLowerCase"],"sources":["/Users/mikhail/Downloads/ЗаметкиPARADIZE/frontend/src/components/Tags/TagAutocomplete.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { tagsAPI } from '../../api/api';\nimport './TagAutocomplete.css';\n\nconst TagAutocomplete = ({ onSelect, selectedTags = [], placeholder = 'Добавить тег...' }) => {\n  const [query, setQuery] = useState('');\n  const [suggestions, setSuggestions] = useState([]);\n  const [showSuggestions, setShowSuggestions] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const inputRef = useRef(null);\n  const suggestionsRef = useRef(null);\n\n  useEffect(() => {\n    if (query.trim().length > 0) {\n      loadSuggestions();\n    } else {\n      setSuggestions([]);\n      setShowSuggestions(false);\n    }\n  }, [query]);\n\n  useEffect(() => {\n    const handleClickOutside = (event) => {\n      if (\n        suggestionsRef.current &&\n        !suggestionsRef.current.contains(event.target) &&\n        inputRef.current &&\n        !inputRef.current.contains(event.target)\n      ) {\n        setShowSuggestions(false);\n      }\n    };\n\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => document.removeEventListener('mousedown', handleClickOutside);\n  }, []);\n\n  const loadSuggestions = async () => {\n    try {\n      setLoading(true);\n      const response = await tagsAPI.autocomplete(query);\n      const filtered = (response.data || []).filter(\n        tag => !selectedTags.includes(tag.id)\n      );\n      setSuggestions(filtered);\n      setShowSuggestions(filtered.length > 0);\n    } catch (error) {\n      console.error('Error loading suggestions:', error);\n      setSuggestions([]);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleInputChange = (e) => {\n    setQuery(e.target.value);\n  };\n\n  const handleSelect = (tag) => {\n    if (onSelect) {\n      onSelect(tag);\n    }\n    setQuery('');\n    setShowSuggestions(false);\n  };\n\n  const handleKeyDown = (e) => {\n    if (e.key === 'Enter' && suggestions.length > 0) {\n      e.preventDefault();\n      handleSelect(suggestions[0]);\n    } else if (e.key === 'Escape') {\n      setShowSuggestions(false);\n    }\n  };\n\n  const handleCreateNew = () => {\n    if (query.trim() && onSelect) {\n      // Создаем новый тег\n      onSelect({ name: query.trim(), isNew: true });\n      setQuery('');\n      setShowSuggestions(false);\n    }\n  };\n\n  return (\n    <div className=\"tag-autocomplete\">\n      <div className=\"tag-autocomplete-input-wrapper\">\n        <input\n          ref={inputRef}\n          type=\"text\"\n          className=\"tag-autocomplete-input\"\n          value={query}\n          onChange={handleInputChange}\n          onKeyDown={handleKeyDown}\n          onFocus={() => {\n            if (suggestions.length > 0) {\n              setShowSuggestions(true);\n            }\n          }}\n          placeholder={placeholder}\n        />\n        {loading && <span className=\"autocomplete-loading\">⏳</span>}\n      </div>\n\n      {showSuggestions && suggestions.length > 0 && (\n        <div ref={suggestionsRef} className=\"tag-autocomplete-suggestions\">\n          {suggestions.map(tag => (\n            <div\n              key={tag.id}\n              className=\"tag-suggestion-item\"\n              onClick={() => handleSelect(tag)}\n              style={{ borderLeftColor: tag.color }}\n            >\n              <span className=\"tag-suggestion-name\">{tag.name}</span>\n              <span className=\"tag-suggestion-count\">({tag.notes_count || 0})</span>\n            </div>\n          ))}\n          {query.trim() && !suggestions.find(t => t.name.toLowerCase() === query.toLowerCase()) && (\n            <div\n              className=\"tag-suggestion-item tag-suggestion-create\"\n              onClick={handleCreateNew}\n            >\n              <span>+ Создать тег \"{query.trim()}\"</span>\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default TagAutocomplete;\n\n\n\n\n\n\n\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}