{"ast":null,"code":"import{useState,useEffect,useRef,useCallback}from'react';import api from'../../api/api';const useTypingTracker=(noteId,onSpeedUpdate)=>{const[sessionId,setSessionId]=useState(null);const[charactersTyped,setCharactersTyped]=useState(0);const[wordsTyped,setWordsTyped]=useState(0);const[typingSpeedWPM,setTypingSpeedWPM]=useState(0);const[typingSpeedCPM,setTypingSpeedCPM]=useState(0);const startTimeRef=useRef(null);const keystrokeTimerRef=useRef(null);const lastKeystrokeTimeRef=useRef(null);// Начать сессию печати\nconst startSession=useCallback(async()=>{try{const response=await api.post('/typing-sessions/start/',{note_id:noteId||null});if(response.data&&response.data.session_id){setSessionId(response.data.session_id);startTimeRef.current=new Date();lastKeystrokeTimeRef.current=new Date();}}catch(error){console.error('Error starting typing session:',error);}},[noteId]);// Завершить сессию печати\nconst endSession=useCallback(async()=>{if(!sessionId)return;try{await api.post('/typing-sessions/end/',{session_id:sessionId,characters_typed:charactersTyped,words_typed:wordsTyped,errors_count:0});setSessionId(null);setCharactersTyped(0);setWordsTyped(0);setTypingSpeedWPM(0);setTypingSpeedCPM(0);startTimeRef.current=null;}catch(error){console.error('Error ending typing session:',error);}},[sessionId,charactersTyped,wordsTyped]);// Отслеживание нажатий клавиш\nconst handleKeystroke=useCallback(text=>{if(!sessionId&&!startTimeRef.current){startSession();}const newCharacters=text.length;const newWords=text.trim().split(/\\s+/).filter(word=>word.length>0).length;setCharactersTyped(newCharacters);setWordsTyped(newWords);// Рассчитываем скорость в реальном времени\nif(startTimeRef.current){const now=new Date();const duration=(now-startTimeRef.current)/1000/60;// в минутах\nif(duration>0){const wpm=newWords/duration;const cpm=newCharacters/duration;setTypingSpeedWPM(Math.round(wpm));setTypingSpeedCPM(Math.round(cpm));if(onSpeedUpdate){onSpeedUpdate({wpm:Math.round(wpm),cpm:Math.round(cpm)});}}}// Отправляем данные на сервер каждые 5 секунд\nlastKeystrokeTimeRef.current=new Date();if(keystrokeTimerRef.current){clearTimeout(keystrokeTimerRef.current);}keystrokeTimerRef.current=setTimeout(async()=>{if(sessionId){try{await api.post('/typing-sessions/keystroke/',{session_id:sessionId,characters_typed:newCharacters,words_typed:newWords});}catch(error){console.error('Error sending keystroke data:',error);}}},5000);},[sessionId,onSpeedUpdate,startSession]);// Автоматическое завершение сессии при размонтировании\nuseEffect(()=>{return()=>{if(keystrokeTimerRef.current){clearTimeout(keystrokeTimerRef.current);}endSession();};},[endSession]);// Автоматическое завершение сессии при отсутствии активности (30 секунд)\nuseEffect(()=>{if(!sessionId)return;const inactivityTimer=setInterval(()=>{if(lastKeystrokeTimeRef.current){const timeSinceLastKeystroke=(new Date()-lastKeystrokeTimeRef.current)/1000;if(timeSinceLastKeystroke>30){endSession();}}},10000);// Проверяем каждые 10 секунд\nreturn()=>clearInterval(inactivityTimer);},[sessionId,endSession]);return{handleKeystroke,typingSpeedWPM,typingSpeedCPM,charactersTyped,wordsTyped,endSession};};export default useTypingTracker;","map":{"version":3,"names":["useState","useEffect","useRef","useCallback","api","useTypingTracker","noteId","onSpeedUpdate","sessionId","setSessionId","charactersTyped","setCharactersTyped","wordsTyped","setWordsTyped","typingSpeedWPM","setTypingSpeedWPM","typingSpeedCPM","setTypingSpeedCPM","startTimeRef","keystrokeTimerRef","lastKeystrokeTimeRef","startSession","response","post","note_id","data","session_id","current","Date","error","console","endSession","characters_typed","words_typed","errors_count","handleKeystroke","text","newCharacters","length","newWords","trim","split","filter","word","now","duration","wpm","cpm","Math","round","clearTimeout","setTimeout","inactivityTimer","setInterval","timeSinceLastKeystroke","clearInterval"],"sources":["/Users/mikhail/Downloads/ЗаметкиPARADIZE/frontend/src/components/Statistics/TypingTracker.js"],"sourcesContent":["import { useState, useEffect, useRef, useCallback } from 'react';\nimport api from '../../api/api';\n\nconst useTypingTracker = (noteId, onSpeedUpdate) => {\n  const [sessionId, setSessionId] = useState(null);\n  const [charactersTyped, setCharactersTyped] = useState(0);\n  const [wordsTyped, setWordsTyped] = useState(0);\n  const [typingSpeedWPM, setTypingSpeedWPM] = useState(0);\n  const [typingSpeedCPM, setTypingSpeedCPM] = useState(0);\n  const startTimeRef = useRef(null);\n  const keystrokeTimerRef = useRef(null);\n  const lastKeystrokeTimeRef = useRef(null);\n\n  // Начать сессию печати\n  const startSession = useCallback(async () => {\n    try {\n      const response = await api.post('/typing-sessions/start/', {\n        note_id: noteId || null\n      });\n      if (response.data && response.data.session_id) {\n        setSessionId(response.data.session_id);\n        startTimeRef.current = new Date();\n        lastKeystrokeTimeRef.current = new Date();\n      }\n    } catch (error) {\n      console.error('Error starting typing session:', error);\n    }\n  }, [noteId]);\n\n  // Завершить сессию печати\n  const endSession = useCallback(async () => {\n    if (!sessionId) return;\n\n    try {\n      await api.post('/typing-sessions/end/', {\n        session_id: sessionId,\n        characters_typed: charactersTyped,\n        words_typed: wordsTyped,\n        errors_count: 0\n      });\n      setSessionId(null);\n      setCharactersTyped(0);\n      setWordsTyped(0);\n      setTypingSpeedWPM(0);\n      setTypingSpeedCPM(0);\n      startTimeRef.current = null;\n    } catch (error) {\n      console.error('Error ending typing session:', error);\n    }\n  }, [sessionId, charactersTyped, wordsTyped]);\n\n  // Отслеживание нажатий клавиш\n  const handleKeystroke = useCallback((text) => {\n    if (!sessionId && !startTimeRef.current) {\n      startSession();\n    }\n\n    const newCharacters = text.length;\n    const newWords = text.trim().split(/\\s+/).filter(word => word.length > 0).length;\n\n    setCharactersTyped(newCharacters);\n    setWordsTyped(newWords);\n\n    // Рассчитываем скорость в реальном времени\n    if (startTimeRef.current) {\n      const now = new Date();\n      const duration = (now - startTimeRef.current) / 1000 / 60; // в минутах\n      \n      if (duration > 0) {\n        const wpm = newWords / duration;\n        const cpm = newCharacters / duration;\n        setTypingSpeedWPM(Math.round(wpm));\n        setTypingSpeedCPM(Math.round(cpm));\n\n        if (onSpeedUpdate) {\n          onSpeedUpdate({ wpm: Math.round(wpm), cpm: Math.round(cpm) });\n        }\n      }\n    }\n\n    // Отправляем данные на сервер каждые 5 секунд\n    lastKeystrokeTimeRef.current = new Date();\n    \n    if (keystrokeTimerRef.current) {\n      clearTimeout(keystrokeTimerRef.current);\n    }\n\n    keystrokeTimerRef.current = setTimeout(async () => {\n      if (sessionId) {\n        try {\n          await api.post('/typing-sessions/keystroke/', {\n            session_id: sessionId,\n            characters_typed: newCharacters,\n            words_typed: newWords\n          });\n        } catch (error) {\n          console.error('Error sending keystroke data:', error);\n        }\n      }\n    }, 5000);\n  }, [sessionId, onSpeedUpdate, startSession]);\n\n  // Автоматическое завершение сессии при размонтировании\n  useEffect(() => {\n    return () => {\n      if (keystrokeTimerRef.current) {\n        clearTimeout(keystrokeTimerRef.current);\n      }\n      endSession();\n    };\n  }, [endSession]);\n\n  // Автоматическое завершение сессии при отсутствии активности (30 секунд)\n  useEffect(() => {\n    if (!sessionId) return;\n\n    const inactivityTimer = setInterval(() => {\n      if (lastKeystrokeTimeRef.current) {\n        const timeSinceLastKeystroke = (new Date() - lastKeystrokeTimeRef.current) / 1000;\n        if (timeSinceLastKeystroke > 30) {\n          endSession();\n        }\n      }\n    }, 10000); // Проверяем каждые 10 секунд\n\n    return () => clearInterval(inactivityTimer);\n  }, [sessionId, endSession]);\n\n  return {\n    handleKeystroke,\n    typingSpeedWPM,\n    typingSpeedCPM,\n    charactersTyped,\n    wordsTyped,\n    endSession\n  };\n};\n\nexport default useTypingTracker;\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}